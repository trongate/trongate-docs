<h1>The Pagination Helper</h1>
<p>The Trongate framework includes a built-in <a href="documentation-ref/list_refs/class_reference/the-pagination-class">Pagination class</a> for generating numbered navigation links when displaying multiple pages of content. Below is an example of the pagination output generated by Trongate:</p>

<figure>
    <img src="images/32/paginatiVwds.png" alt="screenshot" style="width:100%">
    <figcaption>Pagination screenshot.</figcaption>
</figure>

<h2>How It Works</h2>
<p>Trongate's pagination helper is available for immediate use and can be implemented in three steps:</p>
<ol>
  <li><strong>Define Pagination Data</strong> - Create an array in the controller.</li>
  <li><strong>Pass Data to View</strong> - Send the pagination data to a view file.</li>
  <li><strong>Invoke Pagination</strong> - Call the pagination helper from the view file.</li>
</ol>

<h2>Defining Pagination Data</h2>
<p>The following example demonstrates how to configure pagination data:</p>

[code=php]
$pagination_data["total_rows"] = count($rows);
$pagination_data["limit"] = 10;
$pagination_data["record_name_plural"] = "books";
$pagination_data["include_showing_statement"] = true;
$pagination_data["include_css"] = true;
$data["pagination_data"] = $pagination_data;
[/code]

<p>The pagination helper does not interact directly with the database. Instead, it uses predefined data from a results set.</p>

<h3>Required Properties</h3>
<p>The following properties <strong>must</strong> be included in the <code>$pagination_data</code> array. If any are missing or have an incorrect type, the script will terminate with an error message (e.g., "Pagination Error: Missing required property: total_rows (expected type: int)").</p>

<ul>
  <li><strong><code>total_rows</code></strong>: The total number of records available. <em>Type: int</em></li>
</ul>
[code=vf]$pagination_data["total_rows"] = count($rows);[/code]

<ul>
  <li><strong><code>limit</code></strong>: The maximum number of records per page. <em>Type: int</em></li>
</ul>
[code=vf]$pagination_data["limit"] = 10;[/code]

<ul>
  <li><strong><code>record_name_plural</code></strong>: Specifies the plural label for the records. <em>Type: string</em></li>
</ul>
[code=vf]$pagination_data["record_name_plural"] = "books";[/code]

<h3>Optional Properties</h3>
<p>These properties are optional and have default values if not specified. They allow customization of the pagination behavior and appearance.</p>

<ul>
  <li><strong><code>page_num_segment</code></strong>: The URL segment number indicating the current page. If not specified (default: <code>null</code>), the last URL segment is used if numeric; otherwise, it defaults to page 1. <em>Type: int</em></li>
</ul>
[code=vf]$pagination_data["page_num_segment"] = 3;[/code]

<ul>
  <li><strong><code>pagination_root</code></strong>: The base URL for pagination links. If not specified (default: <code>null</code>), it is derived from the current URL, removing the last segment if numeric, and ensuring a trailing slash. <em>Type: string</em></li>
</ul>
[code=vf]$pagination_data["pagination_root"] = "books/manage/";[/code]

<ul>
  <li><strong><code>include_showing_statement</code></strong>: Determines whether a "Showing x to y of z" statement is displayed above the pagination links. Default: <code>false</code>. <em>Type: bool</em></li>
</ul>
[code=vf]$pagination_data["include_showing_statement"] = true;[/code]

<ul>
  <li><strong><code>include_css</code></strong>: Determines whether default CSS styles are included in the output as a <code>&lt;style&gt;</code> block. Default: <code>false</code>. If omitted or <code>false</code>, you must style the pagination links yourself. <em>Type: bool</em></li>
</ul>
[code=vf]$pagination_data["include_css"] = true;[/code]

<ul>
  <li><strong><code>num_links_per_page</code></strong>: The maximum number of numbered pagination links to display. Default: <code>10</code>. Links are centered around the current page. <em>Type: int</em></li>
</ul>
[code=vf]$pagination_data["num_links_per_page"] = 6;[/code]

<ul>
  <li><strong><code>settings</code></strong>: An array to customize the HTML structure, labels, and ARIA attributes of pagination links. Default: an empty array (<code>[]</code>), which uses predefined defaults (see "Customizing Pagination with <code>settings</code>"). <em>Type: array</em></li>
</ul>
[code=vf]$pagination_data["settings"] = ["first_link" => "Start", "next_link" => "&gt;&gt;"];[/code]

<h4>Customizing Pagination with <code>settings</code></h4>
<p>The <code>settings</code> property allows you to override the default appearance and behavior of pagination links. If not provided, the class uses a predefined <code>$default_settings</code> array. You can specify custom values for any of the following keys:</p>

<ul>
  <li><strong><code>pagination_open</code></strong>: Opening tag for the pagination container. Default: <code>&lt;div class="pagination"&gt;</code></li>
  <li><strong><code>pagination_close</code></strong>: Closing tag for the pagination container. Default: <code>&lt;/div&gt;</code></li>
  <li><strong><code>cur_link_open</code></strong>: Opening tag for the current page link. Default: <code>&lt;a class="active"&gt;</code></li>
  <li><strong><code>cur_link_close</code></strong>: Closing tag for the current page link. Default: <code>&lt;/a&gt;</code></li>
  <li><strong><code>num_link_open</code></strong>: Opening tag for numbered links. Default: <code>''</code> (empty string)</li>
  <li><strong><code>num_link_close</code></strong>: Closing tag for numbered links. Default: <code>''</code> (empty string)</li>
  <li><strong><code>first_link</code></strong>: Text for the "First" button. Default: <code>First</code></li>
  <li><strong><code>first_link_open</code></strong>: Opening tag for the "First" button. Default: <code>''</code></li>
  <li><strong><code>first_link_close</code></strong>: Closing tag for the "First" button. Default: <code>''</code></li>
  <li><strong><code>first_link_aria_label</code></strong>: ARIA label for the "First" button. Default: <code>First page</code></li>
  <li><strong><code>last_link</code></strong>: Text for the "Last" button. Default: <code>Last</code></li>
  <li><strong><code>last_link_open</code></strong>: Opening tag for the "Last" button. Default: <code>''</code></li>
  <li><strong><code>last_link_close</code></strong>: Closing tag for the "Last" button. Default: <code>''</code></li>
  <li><strong><code>last_link_aria_label</code></strong>: ARIA label for the "Last" button. Default: <code>Last page</code></li>
  <li><strong><code>prev_link</code></strong>: Text for the "Previous" button. Default: <code>&laquo;</code></li>
  <li><strong><code>prev_link_open</code></strong>: Opening tag for the "Previous" button. Default: <code>''</code></li>
  <li><strong><code>prev_link_close</code></strong>: Closing tag for the "Previous" button. Default: <code>''</code></li>
  <li><strong><code>prev_link_aria_label</code></strong>: ARIA label for the "Previous" button. Default: <code>Previous page</code></li>
  <li><strong><code>next_link</code></strong>: Text for the "Next" button. Default: <code>&raquo;</code></li>
  <li><strong><code>next_link_open</code></strong>: Opening tag for the "Next" button. Default: <code>''</code></li>
  <li><strong><code>next_link_close</code></strong>: Closing tag for the "Next" button. Default: <code>''</code></li>
  <li><strong><code>next_link_aria_label</code></strong>: ARIA label for the "Next" button. Default: <code>Next page</code></li>
</ul>

<p><strong>Example:</strong></p>
[code=php]
$custom_settings = [
    "pagination_open" => "&lt;nav class=\"pag-nav\"&gt;",
    "pagination_close" => "&lt;/nav&gt;",
    "cur_link_open" => "&lt;span class=\"current\"&gt;",
    "cur_link_close" => "&lt;/span&gt;",
    "first_link" => "&lt;&lt; Start",
    "last_link" => "End &gt;&gt;",
    "prev_link" => "&lt; Prev",
    "next_link" => "Next &gt;",
    "first_link_aria_label" => "Go to first page"
];
$pagination_data["settings"] = $custom_settings;
[/code]
<p>If any required keys are missing from your custom <code>settings</code> array, the script will terminate with an error (e.g., "Pagination Error: Missing required settings property: pagination_open").</p>

<h4>Default CSS with <code>include_css</code></h4>
<p>When <code>include_css</code> is set to <code>true</code>, the following CSS is injected into the HTML output as a <code>&lt;style&gt;</code> block:</p>

[code=css]
.pagination {
    display: inline-block;
    margin: 0 0 1em 0;
}
.pagination:last-of-type {
    margin-top: 1em;
}
.pagination a {
    color: black;
    float: left;
    padding: 8px 16px;
    text-decoration: none;
    border: 1px solid #ddd;
}
.pagination a.active {
    background-color: var(--primary);
    color: white;
    border: 1px solid var(--primary);
}
.pagination a:hover:not(.active) {
    background-color: #ddd;
}
.pagination a:first-child {
    border-top-left-radius: 5px;
    border-bottom-left-radius: 5px;
}
.pagination a:last-child {
    border-top-right-radius: 5px;
    border-bottom-right-radius: 5px;
}
@media screen and (max-width: 550px) {
    .pagination a {
        padding: 10px 14px; /* Larger touch targets on mobile */
    }
}
[/code]
<p>This provides a clean, responsive design with hover effects, an active state, and larger touch targets on mobile devices. If you prefer custom styles, set <code>include_css</code> to <code>false</code> and define your own CSS.</p>

<h3>Derived Properties</h3>
<p>The <code>Pagination</code> class calculates the following properties automatically and adds them to <code>$pagination_data</code>. These are not set manually but are available for reference:</p>
<ul>
  <li><strong><code>root</code></strong>: The full base URL for pagination links (e.g., <code>http://example.com/books/manage/</code>).</li>
  <li><strong><code>current_page</code></strong>: The current page number (e.g., <code>2</code>).</li>
  <li><strong><code>start</code></strong>: The first page number in the link range (e.g., <code>1</code>).</li>
  <li><strong><code>end</code></strong>: The last page number in the link range (e.g., <code>10</code>).</li>
  <li><strong><code>num_links_to_side</code></strong>: Half of <code>num_links_per_page</code> for link distribution (e.g., <code>5</code>).</li>
  <li><strong><code>num_pages</code></strong>: Total number of pages (e.g., <code>ceil(total_rows / limit)</code>).</li>
  <li><strong><code>prev</code></strong>: Previous page number or empty string if on page 1.</li>
  <li><strong><code>next</code></strong>: Next page number or last page number if on the last page.</li>
  <li><strong><code>showing_statement</code></strong>: Text like "Showing 11 to 20 of 100 books." if <code>include_showing_statement</code> is <code>true</code>.</li>
</ul>

<h2>Passing Pagination Data to a View File</h2>
<p>The example below demonstrates how to declare and pass pagination data in a controller:</p>

[code=php]
function manage() {
  $data["headline"] = "Manage Books";
  $all_rows = $this-&gt;model-&gt;get("book_title");

  $pagination_data["total_rows"] = count($all_rows);
  $pagination_data["limit"] = $this-&gt;_get_limit();
  $pagination_data["record_name_plural"] = "books";
  $pagination_data["include_showing_statement"] = true;
  $pagination_data["include_css"] = true;
  $data["pagination_data"] = $pagination_data;

  $data["rows"] = $this-&gt;_reduce_rows($all_rows);
  $data["view_module"] = "books";
  $data["view_file"] = "manage";
  $this-&gt;template("admin", $data);
}
[/code]

<h2>Invoking Pagination from a View File</h2>
<p>Once the pagination data has been passed into a view file, pagination elements can be rendered by invoking the <span class="feature-ref" ref-path="class_reference/The_Pagination_Class">display()</span> method:</p>

[code=vf]&lt;?= Pagination::display($pagination_data) ?&gt;[/code]

<h2>Mobile-Friendly Pagination</h2>
<p>When viewed on smaller screens, pagination components can extend beyond the screen width, leading to usability issues. The default CSS (with <code>include_css</code> set to <code>true</code>) includes a media query for screens under 550px, increasing padding for touch targets. For further customization, consider these approaches:</p>
<ul>
  <li>Using CSS media queries to hide or modify pagination elements on smaller screens.</li>
  <li>Implementing a simplified mobile format (e.g., "Previous" and "Next" buttons only).</li>
  <li>Using JavaScript to dynamically adjust pagination based on screen width.</li>
</ul>

<p>Below is an example JavaScript solution for mobile pagination:</p>

[code=javascript]
&lt;script&gt;
// Central function to manage pagination based on viewport width
function managePagination() {
    const paginationContainers = document.querySelectorAll('.pagination-container');
    const isMobile = window.innerWidth &lt; 840;

    paginationContainers.forEach(container => container.style.opacity = 0);
    isMobile ? applyMobileView() : applyDesktopView();
    setTimeout(() => {
        paginationContainers.forEach(container => container.style.opacity = 1);
    }, 50);
}

// Function to apply mobile view
function applyMobileView() {
    document.querySelectorAll('.pagination-container').forEach(container => {
        container.classList.add('pagination-mobile');
    });

    document.querySelectorAll('.pagination').forEach(pagination => {
        const links = Array.from(pagination.querySelectorAll('a'));
        const activeLink = pagination.querySelector('a.active') || pagination.querySelector('.active');
        const prevLink = links.find(link => link.textContent.includes('&laquo;'));
        const nextLink = links.find(link => link.textContent.includes('&raquo;'));

        links.forEach(link => link.style.display = 'none');
        [activeLink, prevLink, nextLink].forEach(link => {
            if (link) link.style.display = '';
        });
    });
}

// Function to apply desktop view
function applyDesktopView() {
    document.querySelectorAll('.pagination-container').forEach(container => {
        container.classList.remove('pagination-mobile');
    });

    document.querySelectorAll('.pagination').forEach(pagination => {
        pagination.querySelectorAll('a').forEach(link => link.style.display = '');
    });
}

window.addEventListener('load', managePagination);
let resizeTimer;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    document.querySelectorAll('.pagination-container').forEach(container => container.style.opacity = 0);
    resizeTimer = setTimeout(managePagination, 250);
});
&lt;/script&gt;

&lt;style&gt;
.pagination-container {
    transition: opacity 0.3s ease;
}
&lt;/style&gt;
[/code]


  
  <p>The JavaScript code shown above is structured around three main functions:</p>
  
  <ol>
    <li>
      <strong>managePagination()</strong>: The central function that coordinates everything
      <ul>
        <li>Sets opacity to 0 during manipulation</li>
        <li>Checks viewport width and applies the appropriate view</li>
        <li>Reveals the pagination after changes are complete</li>
      </ul>
    </li>
    <li>
      <strong>applyMobileView()</strong>: Handles the mobile view (screens &lt; 840px)
      <ul>
        <li>Adds the "pagination-mobile" class for styling hooks</li>
        <li>Shows only essential elements: active page, previous («), and next (»)</li>
        <li>Hides all other pagination links</li>
      </ul>
    </li>
    <li>
      <strong>applyDesktopView()</strong>: Handles the desktop view (screens ≥ 840px)
      <ul>
        <li>Removes the "pagination-mobile" class</li>
        <li>Shows all pagination links</li>
      </ul>
    </li>
  </ol>
  
  <p>The code also includes debounced resize handling to prevent performance issues during browser resizing.</p>
  
  <p>This approach gives us the best of both worlds - a fully featured pagination on desktop and a simplified, touch-friendly version on mobile, all while maintaining the core functionality of the Trongate framework.</p>

<div class="alert alert-info">
  <p>For the above JavaScript to work, wrap each pagination element in a <code>&lt;div class="pagination-container"&gt;</code> with initial <code>opacity: 0</code>:</p>

[code=vf]
&lt;?php if (isset($pagination_data)) { ?&gt;
    &lt;div class="pagination-container" style="opacity: 0;"&gt;&lt;?= Pagination::display($pagination_data) ?&gt;&lt;/div&gt;
&lt;?php } ?&gt;
[/code]

  <p>The <code>.pagination-mobile</code> class is added on mobile devices, allowing custom styling:</p>

[code=css]
.pagination-container {
    transition: opacity 0.3s ease;
}
.pagination-mobile .pagination a:first-child,
.pagination-mobile .pagination a:last-child {
    border-radius: 0;
}
[/code]
</div>

<h2>Final Thoughts</h2>
<p>Trongate's <a href="documentation-ref/list_refs/class_reference/the-pagination-class">Pagination class</a> provides a flexible way to add pagination to webpages. Recent enhancements include automatic URL segment detection, customizable <code>settings</code>, and ARIA attributes for accessibility. Whether using the default styles with <code>include_css</code> or tailoring the output with custom <code>settings</code>, the class offers a robust solution for developers.</p>